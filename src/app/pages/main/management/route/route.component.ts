import { RouteService } from '@/app/core/services/route.service';
import { UiService } from '@/app/core/services/ui.service';
import { FormData, FormField, GenericFormComponent } from '@/app/shared/components/generic-form/generic-form.component';
import { GenericTableComponent } from '@/app/shared/components/generic-table/generic-table.component';
import { routeTableConfig } from '@/app/shared/config/table.config';
import { NEW_ROUTE_FORM_JSON } from '@/app/shared/constants/route';
import { IMutateRoute, IRoute } from '@/app/shared/interfaces/route.interfaces';
import { TableConfig } from '@/app/shared/interfaces/table.interface';
import { Component, signal, TemplateRef, ViewChild } from '@angular/core';
import { LeafletModule } from '@bluehalo/ngx-leaflet';
import * as L from 'leaflet';
import { latLng, Map, tileLayer } from 'leaflet';
import { RouteCreatorComponent } from "../../../../shared/components/route-creator/route-creator.component";
import { RouteMapComponent } from './route-map/route-map.component';

@Component({
  selector: 'app-route',
  imports: [GenericTableComponent, GenericFormComponent, LeafletModule, RouteCreatorComponent, RouteMapComponent],
  templateUrl: './route.component.html',
  styleUrl: './route.component.css'
})
export class RouteComponent {
  @ViewChild("createRouteContent") createRouteContent!: TemplateRef<any>;
  @ViewChild("viewRouteContent") viewRouteContent!: TemplateRef<any>;

  map!: Map;
  loading:boolean = false;
  tableConfig: TableConfig = routeTableConfig;
  tableData: IRoute[] = [];
  mapOptions = {
    layers: [
      tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; Open Street',
        maxZoom: 18,
      })
    ],
    zoom: 5,
    center: latLng(27.54095593, 79.16035184)
  };
  selectedRoute: IRoute | null = null;
  routeFormFields = signal<FormField[]>(NEW_ROUTE_FORM_JSON);
  currentCreatedRouteObject!: { geoJson: any, routeData: any };
  routeData: any = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "name": "Regency to Regency Route ",
        "time": "2025-06-13T07:09:57.634Z"
      },
      "geometry": {
        "type": "LineString",
        "coordinates": [
          [
            73.10864966268585,
            19.20002396895101
          ],
          [
            73.10857372264311,
            19.199942437455274
          ],
          [
            73.10848705376432,
            19.19985204040849
          ],
          [
            73.10830969269321,
            19.199664913761676
          ],
          [
            73.10792479569957,
            19.19926659588888
          ],
          [
            73.10781415457771,
            19.19933498757948
          ],
          [
            73.10792747790859,
            19.199434092111503
          ],
          [
            73.1080562239413,
            19.199581957336665
          ],
          [
            73.10829695220039,
            19.199851723878595
          ],
          [
            73.10839183534429,
            19.199954311011606
          ],
          [
            73.10849141235397,
            19.20005499837502
          ],
          [
            73.10859435845641,
            19.200166716034353
          ],
          [
            73.10869864566332,
            19.200283499704696
          ],
          [
            73.10881733341223,
            19.2004126831869
          ],
          [
            73.10906208498484,
            19.200682448366763
          ],
          [
            73.10919686598784,
            19.200830628994066
          ],
          [
            73.10933634085661,
            19.20098450885306
          ],
          [
            73.10964479489333,
            19.20131823121934
          ],
          [
            73.109840271041,
            19.201538482884143
          ],
          [
            73.11002904166617,
            19.20175176880279
          ],
          [
            73.11031939079203,
            19.202058893292126
          ],
          [
            73.11030614738502,
            19.20208691440654
          ],
          [
            73.11030095060505,
            19.202116202012306
          ],
          [
            73.11030447100438,
            19.20215435505517
          ],
          [
            73.11031201471724,
            19.202181109682012
          ],
          [
            73.11007866253294,
            19.20238184832224
          ],
          [
            73.10994019349255,
            19.20250311456325
          ],
          [
            73.10981915881075,
            19.20261931485167
          ],
          [
            73.1094146353475,
            19.2030104056513
          ],
          [
            73.1093651821188,
            19.20306644754142
          ],
          [
            73.10933182214417,
            19.203117423496327
          ],
          [
            73.1092991327218,
            19.203179797801013
          ],
          [
            73.10924900894084,
            19.203237739413865
          ],
          [
            73.10905052547373,
            19.203456682002642
          ],
          [
            73.10895597760596,
            19.20356298709459
          ],
          [
            73.10887215857424,
            19.20366802570653
          ],
          [
            73.10870049719729,
            19.203893933913854
          ],
          [
            73.1086119842998,
            19.2040075212497
          ],
          [
            73.10852682416358,
            19.204117942383757
          ],
          [
            73.1084378083519,
            19.204243481630705
          ],
          [
            73.10835549806275,
            19.204343691381926
          ],
          [
            73.10816539649882,
            19.204549176796018
          ],
          [
            73.10784889583506,
            19.20493608321717
          ],
          [
            73.10750892584242,
            19.205321089903286
          ],
          [
            73.10725746874728,
            19.205076028464333
          ],
          [
            73.10709720675864,
            19.204918353008143
          ],
          [
            73.10694767360606,
            19.204764476960545
          ],
          [
            73.10681289260306,
            19.204632763952183
          ],
          [
            73.10670308967151,
            19.204710335275816
          ],
          [
            73.1066174266211,
            19.204786640127132
          ],
          [
            73.10646286432662,
            19.2049398830627
          ],
          [
            73.10684172634997,
            19.205303992605433
          ],
          [
            73.10712805216231,
            19.20557818215717
          ],
          [
            73.10727926169552,
            19.20572160925206
          ],
          [
            73.10741437797465,
            19.20585743756671
          ],
          [
            73.10776172404208,
            19.206229143419392
          ],
          [
            73.10793405597128,
            19.206414363114572
          ],
          [
            73.108107729005,
            19.206599582806927
          ],
          [
            73.10880376224436,
            19.207280048552015
          ],
          [
            73.10925638501563,
            19.207718556129244
          ],
          [
            73.10948873137154,
            19.20794350894378
          ],
          [
            73.1097103488914,
            19.20815769700075
          ],
          [
            73.11011938576617,
            19.208556309436055
          ],
          [
            73.11032122199454,
            19.20877081295059
          ],
          [
            73.11053177540221,
            19.208998614064267
          ],
          [
            73.110111003863,
            19.2093503665152
          ],
          [
            73.10990061809339,
            19.2095363742054
          ],
          [
            73.10970498447337,
            19.209725547940025
          ],
          [
            73.10945620958724,
            19.209960154254823
          ],
          [
            73.10921212856688,
            19.210189061590714
          ],
          [
            73.10877878417291,
            19.210594862569554
          ],
          [
            73.10834409867444,
            19.210979134308555
          ],
          [
            73.10788661439933,
            19.211402031901304
          ],
          [
            73.10767195385911,
            19.21161221424387
          ],
          [
            73.1074673516027,
            19.211808465942052
          ],
          [
            73.10724690754928,
            19.212054466605633
          ],
          [
            73.10697147821107,
            19.212308065756677
          ],
          [
            73.10670811881342,
            19.21254013589768
          ],
          [
            73.10661545687385,
            19.21261303375065
          ],
          [
            73.10651072499373,
            19.212688464424183
          ],
          [
            73.10629254405417,
            19.212836159705528
          ],
          [
            73.10609121073999,
            19.21296770771839
          ],
          [
            73.10588987742581,
            19.213087858063062
          ],
          [
            73.10582910862782,
            19.213125929420116
          ],
          [
            73.10570530791797,
            19.213193128121567
          ],
          [
            73.10549391631999,
            19.213302197397468
          ],
          [
            73.10536952887692,
            19.21335206207225
          ],
          [
            73.10521027271666,
            19.213389262700858
          ],
          [
            73.10480324749865,
            19.213480760402213
          ],
          [
            73.10434190754809,
            19.213580489632854
          ],
          [
            73.1039462817184,
            19.213677052843224
          ],
          [
            73.10358954791941,
            19.213775990367445
          ],
          [
            73.10327170615115,
            19.213879993496924
          ],
          [
            73.10312217299857,
            19.213934211263876
          ],
          [
            73.10296191100993,
            19.214004892231827
          ],
          [
            73.10264339868941,
            19.214157651733604
          ],
          [
            73.10252848279693,
            19.21421701408048
          ],
          [
            73.10241356690445,
            19.21430170438495
          ],
          [
            73.1023785724587,
            19.2143161887939
          ],
          [
            73.10234223690846,
            19.214330673202845
          ],
          [
            73.10231394798525,
            19.214359087978604
          ],
          [
            73.10229772900261,
            19.21438370356385
          ],
          [
            73.10219790053584,
            19.214405074018632
          ],
          [
            73.10210708261498,
            19.214439820777425
          ],
          [
            73.10198005487241,
            19.214525856563977
          ],
          [
            73.10186354641833,
            19.214613554520827
          ],
          [
            73.10170529608645,
            19.214746842361436
          ],
          [
            73.101534975814,
            19.214897859715446
          ],
          [
            73.1013190579883,
            19.21509003475195
          ],
          [
            73.10123725061335,
            19.2151429067264
          ],
          [
            73.10113214154758,
            19.215221897731517
          ],
          [
            73.10101496254124,
            19.215290757614945
          ],
          [
            73.10074439470687,
            19.215439874893157
          ],
          [
            73.10046242748417,
            19.215578227844702
          ],
          [
            73.10020862345614,
            19.21571088201782
          ],
          [
            73.09990888659873,
            19.215866330827115
          ],
          [
            73.0996078086368,
            19.21602114639838
          ],
          [
            73.09954678838172,
            19.216041804282835
          ],
          [
            73.0994804037086,
            19.216062462167294
          ],
          [
            73.0993020368091,
            19.21608731494748
          ],
          [
            73.09918871347823,
            19.21608644430958
          ],
          [
            73.09905795578875,
            19.216080508137537
          ],
          [
            73.09896676068225,
            19.21608636516308
          ],
          [
            73.09892267187156,
            19.216083990691494
          ],
          [
            73.09886248980679,
            19.2160790834528
          ],
          [
            73.09867372934737,
            19.216046474069845
          ],
          [
            73.09841154341616,
            19.2159926527552
          ],
          [
            73.09818053816475,
            19.21594358035005
          ],
          [
            73.09798171942153,
            19.215889442406333
          ],
          [
            73.09793872025826,
            19.215874483212268
          ],
          [
            73.09788365115442,
            19.215845593781122
          ],
          [
            73.09777217184224,
            19.215772618290785
          ],
          [
            73.09755122487464,
            19.215588042489003
          ],
          [
            73.09741242055811,
            19.215462670091735
          ],
          [
            73.09722366009869,
            19.215356135117705
          ],
          [
            73.09715274919786,
            19.215331361383374
          ],
          [
            73.09706566122391,
            19.215315175347655
          ],
          [
            73.09697857324996,
            19.215311653206403
          ],
          [
            73.09686156188168,
            19.215325504339244
          ],
          [
            73.09676466708102,
            19.215349486587062
          ],
          [
            73.09655880753913,
            19.21539111913529
          ],
          [
            73.09619570349373,
            19.215481032714518
          ],
          [
            73.09603795607605,
            19.21550509409068
          ],
          [
            73.09580913011946,
            19.215521557138718
          ],
          [
            73.09542607714452,
            19.21554086954833
          ],
          [
            73.09530395281531,
            19.215533429518374
          ],
          [
            73.09513354872384,
            19.215518391161574
          ],
          [
            73.09477731783905,
            19.215451589176933
          ],
          [
            73.0946709514878,
            19.215424520127478
          ],
          [
            73.09454983298697,
            19.215388586357502
          ],
          [
            73.09451798175492,
            19.21536084451869
          ],
          [
            73.09448210720934,
            19.21534070101449
          ],
          [
            73.09443751548447,
            19.21532942223383
          ],
          [
            73.0943929237596,
            19.215337139293037
          ],
          [
            73.0943604019753,
            19.215352771279886
          ],
          [
            73.09433458571353,
            19.21537600160169
          ],
          [
            73.09430843417563,
            19.21542499502218
          ],
          [
            73.09420483385243,
            19.215441932973594
          ],
          [
            73.09414146666445,
            19.21547280119812
          ],
          [
            73.09395220329084,
            19.215525197943503
          ],
          [
            73.09378314030387,
            19.215590970932908
          ],
          [
            73.0937401411406,
            19.215622551462182
          ],
          [
            73.09365146060505,
            19.215689511687412
          ],
          [
            73.09348499600806,
            19.215779266870385
          ],
          [
            73.09332238708653,
            19.21586886362432
          ],
          [
            73.093159778165,
            19.21595592760782
          ],
          [
            73.0928851870171,
            19.216094279830394
          ],
          [
            73.09279751230993,
            19.21614129425764
          ],
          [
            73.09258846764483,
            19.216224400603743
          ],
          [
            73.09239719261446,
            19.21631067289806
          ],
          [
            73.09219518874802,
            19.216412141773617
          ],
          [
            73.09205051709928,
            19.216487649821993
          ],
          [
            73.09199460980513,
            19.216525720441155
          ],
          [
            73.09195613686957,
            19.21656379106032
          ],
          [
            73.09187248547592,
            19.216503954579345
          ],
          [
            73.09176603530564,
            19.216454249140686
          ],
          [
            73.09166914050498,
            19.216420690074816
          ],
          [
            73.09131542419114,
            19.21636053695293
          ],
          [
            73.09097780113139,
            19.21629975064926
          ],
          [
            73.09073807870068,
            19.216257326847206
          ],
          [
            73.09056675259986,
            19.21623263239564
          ],
          [
            73.0905043702855,
            19.216247888317987
          ],
          [
            73.09046478674777,
            19.21626567700491
          ],
          [
            73.09041244176247,
            19.2163075862891
          ],
          [
            73.09035334934511,
            19.21638633932802
          ],
          [
            73.0903089252583,
            19.21646786252302
          ],
          [
            73.09024572570839,
            19.216651962537476
          ],
          [
            73.09018722002425,
            19.2168499926575
          ],
          [
            73.09011144761958,
            19.217093770173637
          ],
          [
            73.09007087920823,
            19.217237187113778
          ],
          [
            73.09002896969237,
            19.21735780930922
          ],
          [
            73.08969536994614,
            19.21715930500577
          ],
          [
            73.08951985289373,
            19.217062268998998
          ],
          [
            73.08935774688639,
            19.216981695879955
          ],
          [
            73.08932354872145,
            19.217106773034168
          ],
          [
            73.0893017557732,
            19.217190670304287
          ],
          [
            73.08929203276553,
            19.21730939287843
          ],
          [
            73.08928381850042,
            19.217437771470948
          ],
          [
            73.08926487539925,
            19.217558551824684
          ],
          [
            73.08924442355551,
            19.217653846412286
          ],
          [
            73.08921944548406,
            19.217768927555483
          ],
          [
            73.08920662117221,
            19.21781792019548
          ],
          [
            73.0891569164864,
            19.21791123578907
          ],
          [
            73.08908734669008,
            19.218041197009438
          ],
          [
            73.08905624982931,
            19.218104278107777
          ],
          [
            73.08903824969225,
            19.218131287398446
          ],
          [
            73.08900214464434,
            19.218171593552285
          ],
          [
            73.08902448241629,
            19.218188254296706
          ],
          [
            73.08905482490577,
            19.21820614160041
          ],
          [
            73.08914216433682,
            19.2182905131815
          ],
          [
            73.08925431420126,
            19.218397046170722
          ],
          [
            73.08933561866202,
            19.218457989990625
          ],
          [
            73.08955321286835,
            19.218609004060344
          ],
          [
            73.08977080707469,
            19.218785345410943
          ],
          [
            73.09019861941256,
            19.21911333303208
          ],
          [
            73.0904381742052,
            19.21928864403213
          ],
          [
            73.09066700016179,
            19.21946648771987
          ],
          [
            73.09112867538848,
            19.219833572277192
          ],
          [
            73.09163661872067,
            19.220173430219837
          ],
          [
            73.09215931420245,
            19.220567741295675
          ],
          [
            73.09235444490828,
            19.22036132529931
          ],
          [
            73.09257773880877,
            19.220113752876262
          ],
          [
            73.0926689758248,
            19.220036386433517
          ],
          [
            73.09278301161744,
            19.219943823753248
          ],
          [
            73.09302717645683,
            19.219751100265086
          ],
          [
            73.09331023332693,
            19.21954444684981
          ],
          [
            73.09354501043477,
            19.219349190646298
          ],
          [
            73.09385199763842,
            19.219088122375652
          ],
          [
            73.09419519466378,
            19.218759303871266
          ],
          [
            73.09436539968506,
            19.21891889515664
          ],
          [
            73.09445217857633,
            19.218999007361976
          ],
          [
            73.09448953305169,
            19.219032731657396
          ],
          [
            73.0945389574676,
            19.21905252598337
          ],
          [
            73.09463696810913,
            19.219062671649137
          ],
          [
            73.09481270780584,
            19.219042417268216
          ],
          [
            73.09492069422181,
            19.219030390536282
          ],
          [
            73.09496967203945,
            19.219029761051726
          ],
          [
            73.09505146189754,
            19.21885037303097
          ],
          [
            73.09516074439803,
            19.21860766690223
          ],
          [
            73.09520398625996,
            19.2185170231486
          ],
          [
            73.095266003585,
            19.218421313935725
          ],
          [
            73.09547318671453,
            19.218233694603665
          ],
          [
            73.0955561212672,
            19.21815956253506
          ],
          [
            73.09563245726072,
            19.21808197273537
          ],
          [
            73.09566056697368,
            19.21803494644187
          ],
          [
            73.09567928895508,
            19.217991719253888
          ],
          [
            73.09574445387302,
            19.217851736059615
          ],
          [
            73.09577234246622,
            19.217779844912695
          ],
          [
            73.09580559547744,
            19.21768389272572
          ],
          [
            73.09590625056235,
            19.21740120089805
          ],
          [
            73.0960048939905,
            19.21710394566741
          ],
          [
            73.09617133544312,
            19.216560090097783
          ],
          [
            73.09622706352702,
            19.21628436311449
          ],
          [
            73.09628815602896,
            19.21602256633292
          ],
          [
            73.09636735344175,
            19.21577343340994
          ],
          [
            73.09646532631764,
            19.215514169399253
          ],
          [
            73.09642045928787,
            19.215525771226588
          ],
          [
            73.09637022784007,
            19.215661479039618
          ],
          [
            73.09632206802026,
            19.215801190297498
          ],
          [
            73.09624050053021,
            19.216056551425527
          ],
          [
            73.09617066770461,
            19.216374281801762
          ],
          [
            73.09614782123238,
            19.216484391308303
          ],
          [
            73.0961169281331,
            19.21660716461922
          ],
          [
            73.09596217505619,
            19.217111238191663
          ],
          [
            73.09587809299519,
            19.217356943079224
          ],
          [
            73.0957953520387,
            19.21760138155624
          ],
          [
            73.09572183398946,
            19.217820997846978
          ],
          [
            73.09560808280499,
            19.218052011469013
          ],
          [
            73.09556606632573,
            19.218100108807214
          ],
          [
            73.09551332101042,
            19.218154537985445
          ],
          [
            73.09538369049865,
            19.21826972817759
          ],
          [
            73.09523976446276,
            19.218398799242504
          ],
          [
            73.09517805613855,
            19.218489621717545
          ],
          [
            73.09512975885941,
            19.218580444192597
          ],
          [
            73.09507339743637,
            19.218716500024197
          ],
          [
            73.09494394581766,
            19.218998187462713
          ],
          [
            73.09463813895623,
            19.219030401629382
          ],
          [
            73.09459150054086,
            19.219033489307364
          ],
          [
            73.09456766090211,
            19.21902771245946
          ],
          [
            73.09453711574083,
            19.219021302430967
          ],
          [
            73.09450388837054,
            19.21900729423691
          ],
          [
            73.09438975435246,
            19.218900607006166
          ],
          [
            73.09418869868882,
            19.218716366260157
          ],
          [
            73.09400607797348,
            19.21888833431737
          ],
          [
            73.09383753885545,
            19.21905270414839
          ],
          [
            73.09374284430437,
            19.21913887585695
          ],
          [
            73.09362266876765,
            19.219237711165384
          ],
          [
            73.09339572873928,
            19.219427783619324
          ],
          [
            73.09327890596383,
            19.21952281983712
          ],
          [
            73.093184881965,
            19.219589996198582
          ],
          [
            73.09295928304114,
            19.21975474149089
          ],
          [
            73.09256533359208,
            19.220073545842464
          ],
          [
            73.09215394978442,
            19.22052088468993
          ],
          [
            73.09170836781182,
            19.22018609283993
          ],
          [
            73.09132715885558,
            19.219926015746008
          ],
          [
            73.09112783719816,
            19.219789645469522
          ],
          [
            73.0909043756596,
            19.219612751830628
          ],
          [
            73.09069834847965,
            19.219444722644802
          ],
          [
            73.09064051334776,
            19.219398897010933
          ],
          [
            73.09088224743523,
            19.219091488086782
          ],
          [
            73.09099439729967,
            19.218958678558952
          ],
          [
            73.09113202814974,
            19.21878977768044
          ],
          [
            73.09131643001952,
            19.218560565871712
          ],
          [
            73.09138935257711,
            19.218452133287975
          ],
          [
            73.0914622751347,
            19.218336102512318
          ],
          [
            73.09155313496508,
            19.2181635601318
          ],
          [
            73.09165505890765,
            19.21792738234412
          ],
          [
            73.09166310553469,
            19.217887808324747
          ],
          [
            73.0916644466392,
            19.217814042323024
          ],
          [
            73.09171674971499,
            19.217475287750116
          ],
          [
            73.09177106444754,
            19.217279000034736
          ],
          [
            73.09182370279946,
            19.217042504373644
          ],
          [
            73.09186360065856,
            19.216879458444552
          ],
          [
            73.09191523318209,
            19.21670089913144
          ],
          [
            73.09196418349661,
            19.216600221986425
          ],
          [
            73.092010116326,
            19.216559381235147
          ],
          [
            73.09208421235003,
            19.216507776251806
          ],
          [
            73.09221966390528,
            19.216437492069794
          ],
          [
            73.09240473632731,
            19.216346312609016
          ],
          [
            73.09249928419509,
            19.216301672659064
          ],
          [
            73.09260590200343,
            19.216255766327237
          ],
          [
            73.0927990210525,
            19.216175984282863
          ],
          [
            73.09308937017836,
            19.216030033544396
          ],
          [
            73.09337301378169,
            19.215881550009147
          ],
          [
            73.09352355276265,
            19.21579543577641
          ],
          [
            73.09368415002741,
            19.215708688351143
          ],
          [
            73.09377936844744,
            19.21563270511641
          ],
          [
            73.09385363210954,
            19.215598354362886
          ],
          [
            73.09394398902573,
            19.215564003609337
          ],
          [
            73.09415152494826,
            19.21550669959004
          ],
          [
            73.09422645916261,
            19.21552474561621
          ],
          [
            73.0943255332581,
            19.21552252943605
          ],
          [
            73.09434158460267,
            19.2155442163251
          ],
          [
            73.09436434146978,
            19.21556083766326
          ],
          [
            73.0944259484581,
            19.215575084525565
          ],
          [
            73.09448084992387,
            19.215570968766567
          ],
          [
            73.09450830065676,
            19.21556131256193
          ],
          [
            73.09453038697161,
            19.215545324419356
          ],
          [
            73.09466583852686,
            19.215551181457872
          ],
          [
            73.09488309745707,
            19.21557983347336
          ],
          [
            73.09527402942099,
            19.215629539179673
          ],
          [
            73.09548508574285,
            19.215642994541174
          ],
          [
            73.09566261445202,
            19.21562985577575
          ],
          [
            73.09605388169207,
            19.215599779081327
          ],
          [
            73.0961128902904,
            19.215597243847334
          ],
          [
            73.09618866269507,
            19.21558331555249
          ],
          [
            73.09622956638255,
            19.215574451315067
          ],
          [
            73.0962838811151,
            19.215562420652397
          ],
          [
            73.09637172346034,
            19.21553899248074
          ],
          [
            73.09646828298487,
            19.215512714918024
          ],
          [
            73.09665268485465,
            19.215464433870753
          ],
          [
            73.09686659102358,
            19.215416152823483
          ],
          [
            73.096941692876,
            19.215412195355917
          ],
          [
            73.09700740699687,
            19.215417102609283
          ],
          [
            73.09706842725195,
            19.215428737552564
          ],
          [
            73.09713078861155,
            19.21545303638156
          ],
          [
            73.09722064261355,
            19.215502900426024
          ],
          [
            73.09737151687064,
            19.21560104544225
          ],
          [
            73.09756396536746,
            19.21575744422179
          ],
          [
            73.09776345466294,
            19.21590687768475
          ],
          [
            73.09781399753906,
            19.215942336458525
          ],
          [
            73.09785649378814,
            19.215963865000983
          ],
          [
            73.09790100169398,
            19.215986659928422
          ],
          [
            73.09796428506293,
            19.216004389318634
          ],
          [
            73.09836996917643,
            19.216086071076713
          ],
          [
            73.09881789808192,
            19.216184215771108
          ],
          [
            73.09898821835436,
            19.216211759593993
          ],
          [
            73.09908611898341,
            19.21621397576363
          ],
          [
            73.09927923803248,
            19.21620542767725
          ],
          [
            73.09945089940943,
            19.216189281295094
          ],
          [
            73.09954678838172,
            19.216167752788728
          ],
          [
            73.09964804177203,
            19.216138625984875
          ],
          [
            73.0997912046782,
            19.216070716127085
          ],
          [
            73.09993704979338,
            19.21599267519995
          ],
          [
            73.10022605781474,
            19.215846724415027
          ],
          [
            73.10073701863207,
            19.215591547563807
          ],
          [
            73.10106022481837,
            19.215426283932715
          ],
          [
            73.10116902192154,
            19.215368663190006
          ],
          [
            73.10131805215993,
            19.21527811633013
          ],
          [
            73.10151284758963,
            19.21512741594805
          ],
          [
            73.10166942154088,
            19.21499127880912
          ],
          [
            73.1018320304624,
            19.214851975692902
          ],
          [
            73.10214517836489,
            19.214620858800906
          ],
          [
            73.10232220415988,
            19.214489470229235
          ],
          [
            73.10234902625002,
            19.21451052404831
          ],
          [
            73.1023812127582,
            19.214522713097555
          ],
          [
            73.10243586276688,
            19.21452231734831
          ],
          [
            73.10248514835753,
            19.214494060895113
          ],
          [
            73.10251029406705,
            19.214451240885918
          ],
          [
            73.10251666431346,
            19.21441095366895
          ],
          [
            73.10260920052447,
            19.21432388894764
          ],
          [
            73.1026782674066,
            19.214274499427965
          ],
          [
            73.10275269870677,
            19.214228909100708
          ],
          [
            73.10300214414515,
            19.214104802102224
          ],
          [
            73.10316274140992,
            19.21403641653369
          ],
          [
            73.10329383437552,
            19.213997158148228
          ],
          [
            73.10349500005164,
            19.213928139375504
          ],
          [
            73.1037766319982,
            19.213844556915095
          ],
          [
            73.10410721425929,
            19.213760341269328
          ],
          [
            73.10443746124425,
            19.21367517571929
          ],
          [
            73.10482671682753,
            19.213577346158313
          ],
          [
            73.10512544785657,
            19.21351909160207
          ],
          [
            73.10543155496039,
            19.21345767104473
          ],
          [
            73.10551319469728,
            19.213427435613898
          ],
          [
            73.10559483443417,
            19.213392134566945
          ],
          [
            73.10578091268458,
            19.213284806745122
          ],
          [
            73.10593446915068,
            19.213197108190876
          ],
          [
            73.10606925015368,
            19.21310940963663
          ],
          [
            73.10634082381644,
            19.212938127972688
          ],
          [
            73.10662714962878,
            19.21274531737576
          ],
          [
            73.10668900807418,
            19.212701784491134
          ],
          [
            73.1068246272675,
            19.212587332661162
          ],
          [
            73.1070355159513,
            19.212399587282597
          ],
          [
            73.1072715503446,
            19.212177331838806
          ],
          [
            73.10747103964009,
            19.211969323129473
          ],
          [
            73.10757179011621,
            19.211863419153524
          ],
          [
            73.10768729274191,
            19.211752449513284
          ],
          [
            73.10790823970952,
            19.211542540658307
          ],
          [
            73.10812851612486,
            19.21132819929989
          ],
          [
            73.10824619804539,
            19.21121643764164
          ],
          [
            73.10837594990649,
            19.211100876720216
          ],
          [
            73.10862338368811,
            19.210875453300236
          ],
          [
            73.10887953464903,
            19.210644964192625
          ],
          [
            73.10910953407206,
            19.210434737296136
          ],
          [
            73.10934690956988,
            19.21021057969173
          ],
          [
            73.1095755678884,
            19.209997186171176
          ],
          [
            73.10980288510241,
            19.209786325500147
          ],
          [
            73.11007714097418,
            19.20952860637473
          ],
          [
            73.11021125142493,
            19.209406078706635
          ],
          [
            73.11036614899554,
            19.209272786340527
          ],
          [
            73.11050092999854,
            19.209162923028263
          ],
          [
            73.1106303465835,
            19.209070789831532
          ],
          [
            73.11077719752707,
            19.20892388294968
          ],
          [
            73.11083318864026,
            19.208870692535324
          ],
          [
            73.11092673067965,
            19.20881116992538
          ],
          [
            73.11075372819819,
            19.20863766753462
          ],
          [
            73.11059480731406,
            19.20847429665569
          ],
          [
            73.11034770880856,
            19.20821594206848
          ],
          [
            73.11010664527335,
            19.20795695421939
          ],
          [
            73.10995761503496,
            19.207802289212275
          ],
          [
            73.10981260811009,
            19.207657755783668
          ],
          [
            73.10952527646937,
            19.207376920862288
          ],
          [
            73.10919067089476,
            19.2070485929119
          ],
          [
            73.10888892238059,
            19.206730396554544
          ],
          [
            73.108670657622,
            19.20651066624806
          ],
          [
            73.10845239286341,
            19.206283970353287
          ],
          [
            73.10818484251418,
            19.206009464928645
          ],
          [
            73.1079266798965,
            19.205746990849164
          ],
          [
            73.10753507738032,
            19.20534488830373
          ],
          [
            73.10764571850218,
            19.20522204103081
          ],
          [
            73.10784990166344,
            19.204987427636546
          ],
          [
            73.10806682531752,
            19.204723685431087
          ],
          [
            73.10819590662636,
            19.204564743115377
          ],
          [
            73.1084409934751,
            19.204297517373675
          ],
          [
            73.10857510392584,
            19.20410944567482
          ],
          [
            73.10876621131816,
            19.20386438258517
          ],
          [
            73.10892379109778,
            19.2036582630929
          ],
          [
            73.10900258098759,
            19.20356153574292
          ],
          [
            73.10910148744502,
            19.20345467655284
          ],
          [
            73.10930667643466,
            19.203228609457028
          ],
          [
            73.10933014576354,
            19.203202013334746
          ],
          [
            73.10942067031779,
            19.20314628810776
          ],
          [
            73.10947464977421,
            19.20310481081029
          ],
          [
            73.10952997033515,
            19.203049402193937
          ],
          [
            73.10983305995383,
            19.20276317657634
          ],
          [
            73.10992207576551,
            19.202683862805635
          ],
          [
            73.10997395974614,
            19.20263470726713
          ],
          [
            73.11001109157719,
            19.20260454903493
          ],
          [
            73.11021125142493,
            19.202436422828935
          ],
          [
            73.11042985145964,
            19.20225784783224
          ],
          [
            73.11048533965864,
            19.202252306936746
          ],
          [
            73.11053009902157,
            19.20223536763043
          ],
          [
            73.11055876513042,
            19.202210196135034
          ],
          [
            73.11057267908969,
            19.202185024639622
          ],
          [
            73.11059145455279,
            19.202149562893602
          ],
          [
            73.11059145455279,
            19.202097636765973
          ],
          [
            73.11058055807867,
            19.202060908501608
          ],
          [
            73.1105389000199,
            19.202013415060055
          ],
          [
            73.11049455975213,
            19.20198998496386
          ],
          [
            73.11045952339687,
            19.20198491900033
          ],
          [
            73.11042582814612,
            19.201983652513164
          ],
          [
            73.11024477903761,
            19.201786079621193
          ],
          [
            73.10999600415148,
            19.201508717276386
          ],
          [
            73.10966609244265,
            19.201145232582324
          ],
          [
            73.10945352737822,
            19.2009134630216
          ],
          [
            73.10924431507506,
            19.20068612620252
          ],
          [
            73.10900492792048,
            19.20042332680167
          ],
          [
            73.10880845611014,
            19.200204221438124
          ],
          [
            73.10868373339095,
            19.200060472963095
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          73.10864966268585,
          19.20002396895101
        ]
      },
      "properties": {
        "name": "Source (Regency Estate)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          73.10868373339095,
          19.200060472963095
        ]
      },
      "properties": {
        "name": "Destination (Regency Estate)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          73.10750892584242,
          19.205321089903286
        ]
      },
      "properties": {
        "name": "Moti Mithai corner/Ventakest Petrol  Pump"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          73.11092673067965,
          19.20881116992538
        ]
      },
      "properties": {
        "name": "Vicco Naka"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          73.10482671682753,
          19.213577346158313
        ]
      },
      "properties": {
        "name": "Pendharkar College"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          73.10229772900261,
          19.21438370356385
        ]
      },
      "properties": {
        "name": "Garda Circle"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          73.09896676068225,
          19.21608636516308
        ]
      },
      "properties": {
        "name": "Shelar Naka"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          73.0943929237596,
          19.215337139293037
        ]
      },
      "properties": {
        "name": "Tilak Chowk"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          73.09196418349661,
          19.216600221986425
        ]
      },
      "properties": {
        "name": "Sarvesh Hall"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          73.09064051334776,
          19.219398897010933
        ]
      },
      "properties": {
        "name": "Phadke Road Cross"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          73.08925431420126,
          19.218397046170722
        ]
      },
      "properties": {
        "name": "IDBI Bank"
      }
    }
  ]
}
  

  constructor(private routeService: RouteService, private uiService: UiService) { }


  ngOnInit(): void {
    this.loadRouteService();
  }

  onMapReady(map: Map) {
    this.map = map;
    setTimeout(() => {
      this.map.invalidateSize();
      // If you have a selected route, add its GeoJSON layer
      if (this.selectedRoute?.geojson) {
        this.addGeoJsonLayer(this.selectedRoute.geojson);
      }
    }, 200);
  }

  private addGeoJsonLayer(geoJson: any): void {
    const geoJsonLayer = L.geoJSON(geoJson, {
      onEachFeature: (feature, layer) => {
        if (feature.properties && feature.properties.name) {
          layer.bindPopup(feature.properties.name);
        }
      },
      pointToLayer: (feature, latlng) => {
      

      // Create a custom icon
      const customIcon = L.icon({
        iconSize: [25, 41],
        iconAnchor: [13, 41],
        iconUrl: 'marker-icon.png', // Ensure the path is correct
        shadowUrl: 'marker-shadow.png', // Ensure the path is correct
       
      });

      return L.marker(latlng, { icon: customIcon });
      },
      style: (feature) => {
        return {
          color: '#ff7800',
          weight: 5,
          opacity: 0.65
        };
      }
    }).addTo(this.map);

    // Fit the map to the bounds of the GeoJSON layer
    this.map.fitBounds(geoJsonLayer.getBounds());
  }


  async loadRouteService() {
    await this.operateRouteList();
  }


  async operateRouteList() {
    this.loading = true;
    try {
      const data: IRoute[] = await this.routeService.getRoutesList();
      this.tableData = data;
      this.loading = false;
    } catch (error) {
      this.uiService.showToast('error', 'Error', 'Failed to fetch parent list');
      this.loading = false;
    }
  }

  async operateRouteWithId(id: number) {
    this.loading = true;
    try {
      const data: IRoute = await this.routeService.getRouteById(id);
      this.selectedRoute = data;
      this.uiService.openDrawer(this.viewRouteContent, 'Route Management');
      this.loading = false;
    } catch (error) {
      this.uiService.showToast('error', 'Error', 'Failed to fetch route');
      this.loading = false;
    }
  }

  async handleConfigActionClicked(event: any) {
    console.log('Config Action Clicked:', event);
    const {action, item} = event;
    switch (action) {
      case 'view':
        await this.operateRouteWithId(item.id);
        this.uiService.openDrawer(this.viewRouteContent, 'Route Management');
        break;
      default:
        break;
    }
  }

  async handleNewRoute() {
    this.uiService.openDrawer(this.createRouteContent, 'Create Route', '!w-[98vw] rounded-l-2xl');
  }

  async handleFormSubmit(formData: FormData): Promise<void> {
    console.log('Form submitted:', formData);
    this.loading = true;
    const routeObj: IMutateRoute = {
      routeName: formData['routeName'],
      routeDirection: formData['routeDirection'], // Assuming this is a string like "UP" or "DOWN"
      geojson: JSON.stringify(this.currentCreatedRouteObject?.geoJson || {}), // Assuming this is the GeoJSON object
      attribute: JSON.stringify(this.currentCreatedRouteObject?.routeData || {}) // Assuming you want to send an empty attribute object
      
    }
    try {
      const response = await this.routeService.createRoute(routeObj);
      console.log(response);
      this.uiService.closeDrawer();
      this.uiService.showToast('success', 'Success', 'Route created successfully');
      await this.operateRouteList();
    } catch (error: any) {
      console.log(error);
      this.uiService.showToast('error', 'Error', 'Failed to create route');
    } finally {
      this.loading = false;
    }
    
  }

  async handleRouteCreated(route: any): Promise<void> {
  console.log('Received GeoJSON:', route);
  this.currentCreatedRouteObject = route;
}

onGeoJsonExport(e: any) {
  console.log(e);
  
}

}
